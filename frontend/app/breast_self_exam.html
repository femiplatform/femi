<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FEMI • Breast Self‑Exam Guide</title>
  <link rel="stylesheet" href="../assets/app.css" />
  <style>
    .bxHero{
      background: linear-gradient(135deg, rgba(251,207,232,.42), rgba(186,230,253,.28));
      border: 1px solid rgba(17,24,39,.08);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 14px 40px rgba(0,0,0,.06);
      backdrop-filter: blur(8px);
    }
    .grid2{ display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 980px){ .grid2{ grid-template-columns: 1.15fr .85fr; } }

    .stepGrid{ display:grid; grid-template-columns: 1fr; gap: 12px; margin-top: 12px; }
    @media (min-width: 980px){ .stepGrid{ grid-template-columns: 1fr 1fr; } }

    .stepCard{ padding: 14px; }
    .stepTop{ display:flex; gap: 12px; align-items:flex-start; }
    .num{
      width: 34px; height: 34px;
      border-radius: 12px;
      display:flex; align-items:center; justify-content:center;
      font-weight: 900;
      border: 1px solid rgba(17,24,39,.10);
      background: rgba(255,255,255,.72);
      flex: 0 0 auto;
    }
    .stTitle{ font-weight: 900; font-size: 16px; }
    .muted2{ opacity:.75; font-size: 12px; }

    .illus{
      border-radius: 16px;
      border: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.72);
      overflow:hidden;
      box-shadow: 0 14px 40px rgba(0,0,0,.06);
      margin-top: 10px;
    }
    .illus svg{ width:100%; height:auto; display:block; }

    .pill{
      display:inline-flex; align-items:center; gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.70);
      font-weight: 900;
      white-space: nowrap;
    }
    .pillOk{ border-color: rgba(34,197,94,.25); background: rgba(220,252,231,.85); }
    .pillWarn{ border-color: rgba(245,158,11,.25); background: rgba(255,237,213,.9); }
    .pillBad{ border-color: rgba(239,68,68,.25); background: rgba(254,226,226,.85); }
    .pillPlan{ border-color: rgba(59,130,246,.22); background: rgba(219,234,254,.85); }

    .checklist{ display:grid; gap: 10px; margin-top: 10px; }
    .chk{
      display:flex; gap: 10px; align-items:flex-start;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(17,24,39,.08);
      background: rgba(255,255,255,.70);
    }
    .chk input{ margin-top: 2px; }
    .chk b{ font-weight: 900; }

    .kpiRow{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
    .big{
      font-size: 28px;
      font-weight: 900;
      background: linear-gradient(135deg, rgba(59,130,246,.88), rgba(236,72,153,.88));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      line-height: 1.1;
    }
    /* Slider (Breast_self_01.jpg - Breast_self_08.jpg) */
    .sCard{ padding:14px; margin-top:12px; }
    .sWrap{ position:relative; border-radius:18px; overflow:hidden; border:1px solid rgba(17,24,39,.08); background: rgba(255,255,255,.72); box-shadow:0 14px 40px rgba(0,0,0,.06); }
    .sViewport{ overflow:hidden; }
    .sTrack{ display:flex; width:100%; transition: transform .28s ease; }
    .sSlide{ min-width:100%; padding: 10px; box-sizing:border-box; }
    .sSlide img{ width:100%; height:auto; display:block; border-radius:16px; border:1px solid rgba(17,24,39,.06); background: rgba(248,250,252,.9); }
    .sNav{
      position:absolute; top:50%; transform: translateY(-50%);
      width:40px; height:40px; border-radius:999px;
      border:1px solid rgba(17,24,39,.10);
      background: rgba(255,255,255,.92);
      box-shadow:0 12px 30px rgba(0,0,0,.12);
      display:flex; align-items:center; justify-content:center;
      font-weight:900; cursor:pointer; user-select:none;
    }
    .sNav:hover{ background: rgba(255,255,255,1); }
    .sNav.prev{ left:10px; }
    .sNav.next{ right:10px; }
    .sDots{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
    .sDot{
      width:10px; height:10px; border-radius:999px;
      border:1px solid rgba(17,24,39,.12);
      background: rgba(226,232,240,.9);
      cursor:pointer;
    }
    .sDot.on{ background: rgba(59,130,246,.55); border-color: rgba(59,130,246,.35); }
    .sMeta{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; margin-bottom:10px; }

  </style>
</head>

<body>
  <div id="app">
    <main class="container">
      <h1 class="page-title">ท่าทางตรวจเต้านมด้วยตนเอง</h1>
      <p class="page-sub muted">คู่มือแบบย่อ + เช็กลิสต์ (ภาพประกอบแนวการ์ตูน 3D โทนพาสเทลแบบ “Pixar‑inspired” ที่ปลอดภัย: ใส่เสื้อ/ไม่แสดงสรีระชัดเจน)</p>

      <div class="grid2">
        <!-- Left -->
        <div class="bxHero">
          <div class="card" style="padding:14px;background:rgba(255,255,255,.72);border:1px solid rgba(17,24,39,.08);box-shadow:0 14px 40px rgba(0,0,0,.06);">
            <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:16px;">ทำเดือนไม่เกิน 1 ครั้ง</div>
                <div class="muted2">ช่วงเหมาะ: หลังหมดประจำเดือน 7–10 วัน (ถ้ามีรอบเดือน) หรือกำหนด “วันประจำเดือน” ของตัวเองทุกเดือน</div>
              </div>
              <span class="pill pillPlan" id="pillStatus">ยังไม่ได้ทำเดือนนี้</span>
            </div>

            <div class="kpiRow">
              <div class="card-soft" style="padding:12px">
                <div class="muted">เดือนนี้</div>
                <div class="big" id="kThis">0</div>
                <div class="muted2" id="kThisText">ยังไม่บันทึก</div>
              </div>
              <div class="card-soft" style="padding:12px">
                <div class="muted">สถิติ 6 เดือน</div>
                <div class="big" id="k6">0</div>
                <div class="muted2" id="k6Text">ครั้งที่ทำแล้ว</div>
              </div>
            </div>

            <div class="actions" style="margin-top:10px">
              <button id="btnDoneOk" class="btn btn-ok">บันทึก: ตรวจแล้ว (ปกติ)</button>
              <button id="btnDoneWatch" class="btn btn-warn">บันทึก: ควรติดตาม</button>
              <button id="btnDoneBad" class="btn btn-ghost" style="border-color:rgba(239,68,68,.25)">บันทึก: พบผิดปกติ</button>
            </div>

            <div style="margin-top:12px">
              <label class="muted">บันทึก/หมายเหตุ</label>
              <textarea id="note" class="input" placeholder="เช่น จุดที่คลำเจอ/อาการเจ็บ/ได้นัดพบแพทย์ ฯลฯ"></textarea>
              <div class="actions" style="margin-top:10px">
                <button id="btnSaveNote" class="btn btn-ghost">บันทึกหมายเหตุ</button>
                <button id="btnClearMonth" class="btn btn-ghost">ล้างข้อมูลเดือนนี้</button>
              </div>
            </div>

            <div class="card-soft" style="padding:12px;margin-top:12px">
              <div style="font-weight:900">พบแพทย์ทันที หากมี</div>
              <div class="muted" style="margin-top:8px;line-height:1.7">
                • ก้อนแข็ง/โตเร็ว • ผิวหนังบุ๋ม/แดง/หนาขึ้น • หัวนมบุ๋มใหม่<br>
                • มีเลือด/น้ำไหลจากหัวนม • ต่อมน้ำเหลืองรักแร้โต
              </div>
            </div>
          </div>

        </div>

        <div class="card sCard">
          <div class="sMeta">
            <div>
              <div style="font-weight:900;font-size:16px">ภาพสาธิตท่าทางตรวจเต้านม</div>
              <div class="muted2">เลื่อนดูภาพ 1–8 (ลดความยาวของหน้า)</div>
            </div>
            <span class="pill pillPlan" id="slideCounter">1/8</span>
          </div>

          <div class="sWrap" id="sWrap" aria-label="Breast self exam slider">
            <button class="sNav prev" id="sPrev" aria-label="previous">‹</button>
            <div class="sViewport">
              <div class="sTrack" id="sTrack">
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_01.jpg" alt="Breast self exam step 1" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_02.jpg" alt="Breast self exam step 2" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_03.jpg" alt="Breast self exam step 3" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_04.jpg" alt="Breast self exam step 4" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_05.jpg" alt="Breast self exam step 5" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_06.jpg" alt="Breast self exam step 6" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_07.jpg" alt="Breast self exam step 7" loading="lazy"></div>
                <div class="sSlide"><img src="https://femi2026.pages.dev/assets/images_breast_self/Breast_self_08.jpg" alt="Breast self exam step 8" loading="lazy"></div>
              </div>
            </div>
            <button class="sNav next" id="sNext" aria-label="next">›</button>
          </div>

          <div class="sDots" id="sDots"></div>
        </div>
      </div>

        <!-- Right -->

        <div>
          <div class="card" style="padding:14px">
            <div style="display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:16px">เช็กลิสต์การตรวจ (ติ๊กได้)</div>
                <div class="muted2">เก็บในเครื่องผู้ใช้</div>
              </div>
              <button id="btnChecklistReset" class="btn btn-ghost">ล้างเช็กลิสต์</button>
            </div>

            <div class="checklist" id="checklist"></div>

            <div class="card-soft" style="padding:12px;margin-top:12px">
              <div style="font-weight:900">ทิปสำคัญ</div>
              <div class="muted" style="margin-top:8px;line-height:1.7">
                • ใช้แรงกด 3 ระดับ: เบา‑กลาง‑ลึก (เพื่อคลำชั้นตื้นและชั้นลึก)<br>
                • ทำให้ “เป็นระบบ” เลือกแบบวงกลม/ขึ้น‑ลง/เป็นรัศมี แล้วทำแบบเดิมทุกครั้ง<br>
                • ถ้าพบความเปลี่ยนแปลงใหม่ ให้บันทึกและปรึกษาหน่วยบริการ
              </div>
            </div>
          </div>

          <div class="card" style="padding:14px;margin-top:12px">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
              <div>
                <div style="font-weight:900;font-size:16px">ประวัติการบันทึก</div>
                <div class="muted2">6 รายการล่าสุด</div>
              </div>
              <button id="btnExport" class="btn btn-ghost">Export CSV</button>
            </div>
            <div id="history" style="display:grid;gap:10px;margin-top:10px"></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script type="module">
    import { initUserShell } from "../js/shell.js";
    import { applyI18n } from "../js/i18n.js";

    await initUserShell({ active: "tools", title: "Breast Self Exam" });
    try{ applyI18n(document); }catch{}

    const LS_KEY = "FEMI_BREAST_SELFEXAM_GUIDE_V1";

    function load(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : { logs: [], checklist: {} };
      }catch{
        return { logs: [], checklist: {} };
      }
    }
    function save(s){ localStorage.setItem(LS_KEY, JSON.stringify(s)); }

    function todayIso(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      return `${yyyy}-${mm}-${dd}`;
    }
    function ym(iso){ return iso.slice(0,7); }
    function nowTs(){ return Date.now(); }

    const pillStatus = document.getElementById("pillStatus");
    const kThis = document.getElementById("kThis");
    const kThisText = document.getElementById("kThisText");
    const k6 = document.getElementById("k6");
    const k6Text = document.getElementById("k6Text");

    const noteEl = document.getElementById("note");
    const btnDoneOk = document.getElementById("btnDoneOk");
    const btnDoneWatch = document.getElementById("btnDoneWatch");
    const btnDoneBad = document.getElementById("btnDoneBad");
    const btnSaveNote = document.getElementById("btnSaveNote");
    const btnClearMonth = document.getElementById("btnClearMonth");

    const checklistEl = document.getElementById("checklist");
    const btnChecklistReset = document.getElementById("btnChecklistReset");

    const historyEl = document.getElementById("history");
    const btnExport = document.getElementById("btnExport");

    const CHECKS = [
      { id:"mirror", title:"ดูหน้ากระจก 3 ท่า", desc:"แขนแนบ → ยกแขน → เท้าเอว" },
      { id:"skin", title:"สังเกตผิวหนัง/รอยบุ๋ม", desc:"บวมแดง ผิวหนาขึ้น ผิวส้ม" },
      { id:"nipple", title:"สังเกตหัวนม", desc:"บุ๋มใหม่ มีเลือด/น้ำไหล" },
      { id:"palpate_stand", title:"คลำขณะยืน/อาบน้ำ", desc:"นิ้ว 3 นิ้ว คลำให้ครบทุกส่วน" },
      { id:"palpate_lie", title:"คลำท่านอน", desc:"วางหมอนใต้ไหล่ ยกแขนขึ้น" },
      { id:"armpit", title:"คลำรักแร้/เหนือไหปลาร้า", desc:"หาก้อน/ต่อมน้ำเหลือง" },
    ];

    function labelForStatus(s){
      if(s==="ok") return { text:"ตรวจแล้ว (ปกติ)", cls:"pill pillOk" };
      if(s==="watch") return { text:"ควรติดตาม", cls:"pill pillWarn" };
      if(s==="abnormal") return { text:"พบผิดปกติ", cls:"pill pillBad" };
      return { text:"-", cls:"pill" };
    }

    let state = load();

    function upsertThisMonth(status){
      const iso = todayIso();
      const month = ym(iso);
      const note = (noteEl.value || "").trim();

      // create log
      state.logs = state.logs || [];
      state.logs.unshift({
        id: "BSE_" + String(nowTs()),
        date: iso,
        month,
        status,
        note,
        updatedAt: nowTs(),
      });

      // keep 24 logs
      state.logs = state.logs.slice(0, 24);
      save(state);
      render();
      toast("บันทึกแล้ว");
    }

    function saveNoteOnly(){
      // store draft note for this month
      const month = ym(todayIso());
      state.noteDraft = state.noteDraft || {};
      state.noteDraft[month] = (noteEl.value || "").trim();
      save(state);
      toast("บันทึกหมายเหตุแล้ว");
    }

    function clearThisMonth(){
      const month = ym(todayIso());
      state.logs = (state.logs || []).filter(x => x.month !== month);
      if(state.noteDraft?.[month]) delete state.noteDraft[month];
      save(state);
      render();
      toast("ล้างข้อมูลเดือนนี้แล้ว");
    }

    btnDoneOk.addEventListener("click", ()=> upsertThisMonth("ok"));
    btnDoneWatch.addEventListener("click", ()=> upsertThisMonth("watch"));
    btnDoneBad.addEventListener("click", ()=> upsertThisMonth("abnormal"));
    btnSaveNote.addEventListener("click", saveNoteOnly);
    btnClearMonth.addEventListener("click", ()=>{
      if(confirm("ล้างข้อมูลเดือนนี้ใช่ไหม?")) clearThisMonth();
    });

    function renderChecklist(){
      state.checklist = state.checklist || {};
      checklistEl.innerHTML = CHECKS.map(c=>{
        const checked = !!state.checklist[c.id];
        return `
          <label class="chk">
            <input type="checkbox" data-chk="${c.id}" ${checked ? "checked":""}/>
            <div style="min-width:0">
              <b>${escapeHtml(c.title)}</b>
              <div class="muted2">${escapeHtml(c.desc)}</div>
            </div>
          </label>
        `;
      }).join("");

      checklistEl.querySelectorAll("[data-chk]").forEach(cb=>{
        cb.addEventListener("change", ()=>{
          const id = cb.getAttribute("data-chk");
          state.checklist[id] = cb.checked;
          save(state);
        });
      });
    }

    btnChecklistReset.addEventListener("click", ()=>{
      if(confirm("ล้างเช็กลิสต์ใช่ไหม?")){
        state.checklist = {};
        save(state);
        renderChecklist();
      }
    });

    function renderHistory(){
      const logs = (state.logs || []).slice(0,6);
      if(!logs.length){
        historyEl.innerHTML = '<div class="muted2">ยังไม่มีประวัติ</div>';
        return;
      }
      historyEl.innerHTML = logs.map(l=>{
        const lab = labelForStatus(l.status);
        return `
          <div class="card" style="padding:12px">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
              <div style="min-width:0">
                <div style="font-weight:900">${l.date}</div>
                <div class="muted2">${l.note ? "โน้ต: " + escapeHtml(l.note) : "—"}</div>
              </div>
              <span class="${lab.cls}">${lab.text}</span>
            </div>
            <div class="actions" style="margin-top:10px">
              <button class="btn btn-ghost" data-del="${l.id}">ลบ</button>
            </div>
          </div>
        `;
      }).join("");

      historyEl.querySelectorAll("[data-del]").forEach(b=>{
        b.addEventListener("click", ()=>{
          const id = b.getAttribute("data-del");
          if(confirm("ลบรายการนี้ใช่ไหม?")){
            state.logs = (state.logs || []).filter(x => x.id !== id);
            save(state);
            render();
          }
        });
      });
    }

    function renderKPIs(){
      const now = new Date();
      const thisMonth = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`;
      const logs = state.logs || [];

      const inMonth = logs.filter(x => x.month === thisMonth);
      const doneThis = inMonth.length;

      // latest status for month
      const latest = inMonth[0] || null;
      if(latest){
        const lab = labelForStatus(latest.status);
        pillStatus.className = lab.cls;
        pillStatus.textContent = lab.text;
        kThisText.textContent = "บันทึกล่าสุด: " + latest.date;
      }else{
        pillStatus.className = "pill pillPlan";
        pillStatus.textContent = "ยังไม่ได้ทำเดือนนี้";
        kThisText.textContent = "แนะนำทำภายในเดือนนี้";
      }

      kThis.textContent = String(doneThis);

      // last 6 months
      const months = [];
      for(let i=0;i<6;i++){
        const d = new Date(now.getFullYear(), now.getMonth()-i, 1);
        months.push(`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`);
      }
      const uniqueMonthsDone = new Set(logs.map(x=>x.month)).size;
      const done6 = months.filter(m => logs.some(x=>x.month===m)).length;

      k6.textContent = String(done6);
      k6Text.textContent = `ทำแล้ว ${done6}/6 เดือน • มีบันทึกทั้งหมด ${logs.length} ครั้ง`;

      // restore draft note
      noteEl.value = state.noteDraft?.[thisMonth] || "";
      if(latest?.note) noteEl.value = latest.note; // prefer latest note
    }

    // Export
    btnExport.addEventListener("click", ()=>{
      const rows = [["date","month","status","note","updatedAt"]];
      const logs = (state.logs || []).slice().sort((a,b)=> a.date.localeCompare(b.date));
      for(const l of logs){
        rows.push([l.date, l.month, l.status, (l.note||"").replaceAll("\n"," "), String(l.updatedAt||"")]);
      }
      const csv = rows.map(r => r.map(x=>{
        const s = String(x ?? "");
        const safe = s.includes(",") || s.includes('"') || s.includes("\n") ? '"' + s.replaceAll('"','""') + '"' : s;
        return safe;
      }).join(",")).join("\n");

      const blob = new Blob([csv], { type:"text/csv;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "breast_self_exam_log.csv";
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(()=> URL.revokeObjectURL(url), 500);
    });

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // toast
    let toastTimer = null;
    function toast(msg){
      clearTimeout(toastTimer);
      let el = document.getElementById("__toast");
      if(!el){
        el = document.createElement("div");
        el.id = "__toast";
        el.style.position = "fixed";
        el.style.left = "50%";
        el.style.bottom = "18px";
        el.style.transform = "translateX(-50%)";
        el.style.padding = "10px 12px";
        el.style.borderRadius = "999px";
        el.style.border = "1px solid rgba(17,24,39,.10)";
        el.style.background = "rgba(255,255,255,.92)";
        el.style.boxShadow = "0 12px 30px rgba(0,0,0,.14)";
        el.style.fontWeight = "900";
        el.style.zIndex = "80";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity = "1";
      toastTimer = setTimeout(()=>{ el.style.opacity = "0"; }, 1600);
    }

    function render(){
      state = load();
      renderKPIs();
      renderChecklist();
      renderHistory();
    }

    // ===== Slider =====
    const sTrack = document.getElementById("sTrack");
    const sDots = document.getElementById("sDots");
    const sPrev = document.getElementById("sPrev");
    const sNext = document.getElementById("sNext");
    const sWrap = document.getElementById("sWrap");
    const slideCounter = document.getElementById("slideCounter");
    const SLIDE_COUNT = 8;
    let slideIndex = 0;

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function updateSlider(){
      slideIndex = clamp(slideIndex, 0, SLIDE_COUNT-1);
      sTrack.style.transform = `translateX(-${slideIndex * 100}%)`;
      if(slideCounter) slideCounter.textContent = `${slideIndex+1}/${SLIDE_COUNT}`;
      if(sDots){
        sDots.querySelectorAll(".sDot").forEach((d, i)=> d.classList.toggle("on", i===slideIndex));
      }
    }
    function buildDots(){
      if(!sDots) return;
      sDots.innerHTML = Array.from({length:SLIDE_COUNT}).map((_,i)=>`<button class="sDot ${i===0?'on':''}" data-i="${i}" aria-label="slide ${i+1}"></button>`).join("");
      sDots.querySelectorAll("[data-i]").forEach(b=>{
        b.addEventListener("click", ()=>{
          slideIndex = Number(b.getAttribute("data-i")) || 0;
          updateSlider();
        });
      });
    }
    if(sPrev && sNext){
      sPrev.addEventListener("click", ()=>{ slideIndex -= 1; updateSlider(); });
      sNext.addEventListener("click", ()=>{ slideIndex += 1; updateSlider(); });
    }
    // Keyboard support
    window.addEventListener("keydown", (e)=>{
      if(document.activeElement && ["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName)) return;
      if(e.key === "ArrowLeft"){ slideIndex -= 1; updateSlider(); }
      if(e.key === "ArrowRight"){ slideIndex += 1; updateSlider(); }
    });
    // Swipe support
    let sx = null, dx = 0;
    if(sWrap){
      sWrap.addEventListener("touchstart", (e)=>{ sx = e.touches[0].clientX; dx = 0; }, {passive:true});
      sWrap.addEventListener("touchmove", (e)=>{ if(sx==null) return; dx = e.touches[0].clientX - sx; }, {passive:true});
      sWrap.addEventListener("touchend", ()=>{
        if(sx==null) return;
        if(Math.abs(dx) > 40){
          slideIndex += (dx < 0 ? 1 : -1);
          updateSlider();
        }
        sx = null; dx = 0;
      });
    }
    buildDots();
    updateSlider();


    render();
  </script>
</body>
</html>
