<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FEMI • คลังความรู้</title>
  <link rel="stylesheet" href="../assets/app.css" />
</head>
<body>
  <div id="app">
    <main class="container">
      <h1 class="page-title" data-i18n="page.knowledge">คลังความรู้</h1>
      <p class="page-sub muted" data-i18n="kp.subtitle">บทความและข่าวสาร</p>

      <div class="tabs">
        <button class="tab active" data-tab="kb" data-i18n="kp.tab.kb">ความรู้</button>
        <button class="tab" data-tab="news" data-i18n="kp.tab.news">ข่าว</button>
      </div>

      <div id="loading" class="muted" data-i18n="common.loading">กำลังโหลด…</div>
      <div id="empty" class="card hidden" style="padding:14px" data-i18n="kp.empty">ยังไม่มีข้อมูล</div>
      <div id="list" style="display:flex;flex-direction:column;gap:10px"></div>
    </main>
  </div>

  <script type="module">
    import { initUserShell } from "../js/shell.js";
    import { api } from "../js/api.js";
    import { t, applyI18n } from "../js/i18n.js";

    await initUserShell({ active: "tools", title: t("page.knowledge") });
    applyI18n(document);

    const tabs = Array.from(document.querySelectorAll('.tab'));
    let tab = 'kb';

    const elLoading = document.getElementById('loading');
    const elEmpty = document.getElementById('empty');
    const elList = document.getElementById('list');

    const esc = (s)=> String(s??'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');

    async function load(){
      elLoading.classList.remove('hidden');
      elEmpty.classList.add('hidden');
      elList.innerHTML = '';
      try {
        const items = tab === 'kb' ? await api.knowledgeList() : await api.newsList();
        if (!items || !items.length){
          elEmpty.classList.remove('hidden');
          return;
        }
        items.forEach(it => {
          const card = document.createElement('div');
          card.className = 'card';
          card.style.padding = '14px';
          card.innerHTML = `
            <div style="font-weight:900">${esc(it.title||'')}</div>
            ${it.summary ? `<div class="muted" style="margin-top:6px">${esc(it.summary)}</div>` : ''}
          `;
          elList.appendChild(card);
        });
      } catch(e){
        console.error(e);
        alert(e?.error?.message || t("kp.loadFailed"));
      } finally {
        elLoading.classList.add('hidden');
      }
    }

    tabs.forEach(b => b.addEventListener('click', async () => {
      tabs.forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      tab = b.dataset.tab;
      await load();
    }));

    await load();
  </script>
</body>
</html>